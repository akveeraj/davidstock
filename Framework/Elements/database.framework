<%
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// 
// ' File Name : Database.Framework
// ' Created   : 24/11/2011
// ' Developer : Patrick Johnson, Clickbanx Limited. www.clickbanx.co.uk
// ' Function  : Opens a requested database connection
// 
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// ' Define Variables
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	
	fb_DBString     = ConnString
	fb_UseDatabase  = UseDatabase
	
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// ' Replace strange symbols
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
	
    Function StrQuoteReplace(strValue)
      StrQuoteReplace = Replace(strValue, "'", "''")
    End Function 
	
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// ' Connect to database
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  Sub Connect( fb_DBString )
	
	  'On Error Resume Next
		Set ConnTemp = Server.CreateObject("adodb.connection")
		ConnTemp.Mode = 3
		ConnTemp.Open fb_DBString
		
	End Sub
	
	Call Connect( fb_DBString )
	
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// ' Standard database query
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  Sub FetchData( SQL, rsTemp, ConnTemp )
	  
		Call Connect( fb_DBString )
		
		Set rsTemp = Server.CreateObject( "adodb.recordset" )
		MySQL      = SQL
		rsTemp.Open MySQL, ConnTemp, 1,2
  
	End Sub
		
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// ' Return random record
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  Sub RandomRecord( SQL, rsTemp, ConnTemp )
	  
		Call Connect( fb_DBString )
		
		Set rsTemp = Server.CreateObject( "adodb.recordset" )
		MySQL      = SQL
		rsTemp.Open MySQL, ConnTemp, 3, 1
		IntTotalRecords = rsTemp.RecordCount
		Randomize()
		IntRandomNumber = Int(intTotalRecords * RND )
		RsTemp.Move IntRandomNumber
	
	End Sub
	


// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// ' Paging Database
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  Sub PagingData( SQL, rsTemp, ConnTemp, PageLimit )
	
	  Call Connect( fb_DBString )
		
		Set rsTemp = Server.CreateObject( "adodb.recordset" )
		rsTemp.CursorLocation = 3
		mySQL = SQL
		rsTemp.Open mySQL, ConnTemp
		ListCount = rsTemp.RecordCount
		rsTemp.PageSize = PageLimit
		nPages = rsTemp.PageCount
	
	End Sub
	
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// ' Horizontal Recordset
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  Sub HorizontalRSet( SQL, rsTemp, ConnTemp, PageLimit )
	
	  Call Connect( fb_DBString )
		
		Set RsTemp = Server.CreateObject( "adodb.recordset" )
		mySQL = SQL
		rsTemp.CursorLocation = 3
		rsTemp.Open mySQL, ConnTemp
		rsTemp.PageSize = PageLimit
		nPages          = rsTemp.PageCount
		
	End Sub

// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// ' Save / Update Record
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------

  Sub SaveRecord( SQL, rsTemp, ConnTemp )
	
	  Call Connect( fb_DBString )
		
		Set rsTemp = ConnTemp.Execute( SQL )
	
	End Sub

// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
// -----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
%>